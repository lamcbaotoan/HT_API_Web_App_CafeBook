@page "/"
@model WebCafebookApi.Pages.TrangChuViewModel
@{
    ViewData["Title"] = "Trang Chủ";
    var bannerStyle = string.IsNullOrEmpty(Model.Info?.BannerImageUrl)
        ? "background-color: #4E342E; color: #FFF8E1;"
        : $"background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('{Model.Info.BannerImageUrl}'); background-size: cover; background-position: center; color: white;";
}

<div class="container-fluid px-0 mb-5">
    <div class="text-center p-5" style="@bannerStyle min-height: 40vh; display: flex; flex-direction: column; justify-content: center; align-items: center;">
        <h1 class="display-3 fw-bold" style="color: inherit;">
            @(Model.Info?.TenQuan ?? "Chào mừng đến Cafebook")
        </h1>
        <p class="lead fs-4 col-md-8" style="color: inherit; opacity: 0.9;">
            @(Model.Info?.GioiThieu ?? "Nơi bạn có thể thưởng thức cà phê thơm ngon, đọc những cuốn sách hay và tìm thấy không gian yên tĩnh cho riêng mình.")
        </p>
        <div class="mt-4">
            <a asp-page="/ThucDonView" class="btn btn-primary btn-lg me-2">Xem Thực Đơn</a>
            <a asp-page="/ThuVienSachView" class="btn btn-outline-light btn-lg">Khám Phá Sách</a>
        </div>
    </div>
</div>


<div class="container">

    @if (Model.Promotions != null && Model.Promotions.Any())
    {
    }

    <div class="row mt-5">
        <h2 class="text-center mb-4 pb-2 border-bottom">☕ Món Nổi Bật</h2>
        @if (Model.MonNoiBat != null && Model.MonNoiBat.Any())
        {
            @foreach (var item in Model.MonNoiBat)
            {
                <div class="col-lg col-md-4 col-sm-6 mb-4">
                    <div class="card h-100">
                        @{
                            // SỬA LỖI LOGIC Ở ĐÂY
                            var imgSrc = string.IsNullOrEmpty(item.AnhSanPhamBase64)
                            ? "/images/default-food-icon.png"  // 1. Lấy ảnh MẶC ĐỊNH từ wwwroot
                            : $"data:image/png;base64,{item.AnhSanPhamBase64}"; // 2. Thêm tiền tố cho Base64
                        }
                        <img src="@imgSrc" class="card-img-top" alt="@item.TenSanPham" style="height: 180px; object-fit: cover;">
                        <div class="card-body d-flex flex-column">
                            <h6 class="card-title">@item.TenSanPham</h6>
                            <p class="card-text text-danger fw-bold mt-auto mb-0">@item.DonGia.ToString("N0") đ</p>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <p class="text-center text-muted">⚙️ Dữ liệu món nổi bật đang được cập nhật...</p>
        }
    </div>

    <div class="row mt-5">
        <h2 class="text-center mb-4 pb-2 border-bottom">📚 Sách Hay Nên Đọc</h2>
        @if (Model.SachNoiBat != null && Model.SachNoiBat.Any())
        {
            @foreach (var sach in Model.SachNoiBat)
            {
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="card h-100">
                        @{
                            // SỬA LỖI TƯƠNG TỰ
                            var imgSrc = string.IsNullOrEmpty(sach.AnhBia)
                            ? "/images/default-book-cover.png" // 1. Lấy ảnh MẶC ĐỊNH
                            : $"data:image/png;base64,{sach.AnhBia}"; // 2. Thêm tiền tố Base64
                        }
                        <img src="@imgSrc" class="card-img-top" alt="@sach.TieuDe" style="height: 250px; object-fit: cover;">
                        <div class="card-body">
                            <h6 class="card-title" style="height: 2.5em; overflow: hidden;">@sach.TieuDe</h6>
                            <p class="card-text text-muted small">@sach.TacGia</p>
                        </div>
                        <div class="card-footer bg-transparent border-0 pb-3">
                            <a asp-page="/ChiTietSachView" asp-route-id="@sach.IdSach" class="btn btn-outline-primary btn-sm w-100">
                                Xem chi tiết
                            </a>
                        </div>
                    </div>
                </div>
            }
        }
        else
        {
            <p class="text-center text-muted">⚙️ Dữ liệu sách nổi bật đang được cập nhật...</p>
        }
    </div>

</div>