<Page x:Class="AppCafebookApi.View.quanly.pages.QuanLyTonKhoView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:AppCafebookApi.View.quanly.pages"
      mc:Ignorable="d" 
      d:DesignHeight="700" d:DesignWidth="1100"
      Title="Quản lý Tồn Kho" FontFamily="Segoe UI" Loaded="Page_Loaded"
      Background="#FFF8E1">

    <Page.Resources>
        <SolidColorBrush x:Key="PrimaryBrownBrush" Color="#6F4E37"/>
        <SolidColorBrush x:Key="DarkBrownBrush" Color="#4E342E"/>
        <SolidColorBrush x:Key="AccentOrangeBrush" Color="#D27D2D"/>
        <SolidColorBrush x:Key="LightCreamBrush" Color="#FFF8E1"/>
        <SolidColorBrush x:Key="WhiteTextBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextGrayBrush" Color="#757575"/>
        <SolidColorBrush x:Key="BorderGrayBrush" Color="#E0E0E0"/>
        <SolidColorBrush x:Key="ActionGreenBrush" Color="#66BB6A"/>
        <SolidColorBrush x:Key="ActionRedBrush" Color="#EF5350"/>
        <SolidColorBrush x:Key="ActionBlueBrush" Color="#42A5F5"/>
        <SolidColorBrush x:Key="StatusYellowBrush" Color="#FFF9C4"/>
        <SolidColorBrush x:Key="StatusRedBrush" Color="#FFEBEE"/>

        <Geometry x:Key="IconWarehouse">M12,3L2,8V21H22V8L12,3M19,19H15V13H9V19H5V9.4L12,5.5L19,9.4V19Z</Geometry>
        <Geometry x:Key="IconBoxIn">M16.75 9H15.25V6H9.25V9H7.75L12.25 13.5L16.75 9M19.35 15.04C19.76 14.63 20 14.11 20 13.5V6C20 4.9 19.1 4 18 4H6C4.9 4 4 4.9 4 6V13.5C4 14.11 4.24 14.63 4.65 15.04L9 19.38V22H15V19.38L19.35 15.04Z</Geometry>
        <Geometry x:Key="IconBoxOut">M5.63 15.04C5.22 14.63 5 14.11 5 13.5V6C5 4.9 5.9 4 7 4H17C18.1 4 19 4.9 19 6V13.5C19 14.11 18.78 14.63 18.37 15.04L14 19.38V22H10V19.38L5.63 15.04M8 11H9.5V14H14.5V11H16L12 6.5L8 11Z</Geometry>
        <Geometry x:Key="IconChecklist">M21,17.45V6.5C21,5.4 20.1,4.5 19,4.5H13V6.5H19V17.45L16.73,15.18L15.32,16.59L20,21.27L21.39,19.89L21,19.5V19.5L21,17.45M11,6.5H5V19.5H11V6.5M9,11.5H7V13.5H9V11.5M17,11.5H13V13.5H17V11.5M17,8.5H13V10.5H17V8.5Z</Geometry>
        <Geometry x:Key="IconSupplier">M16,13C17.7,13 21,13.9 21,15.5V17H11V15.5C11,13.9 14.3,13 16,13M8,13C9.7,13 13,13.9 13,15.5V17H3V15.5C3,13.9 6.3,13 8,13M8,11.5A3.5,3.5 0 0,0 11.5,8A3.5,3.5 0 0,0 8,4.5A3.5,3.5 0 0,0 4.5,8A3.5,3.5 0 0,0 8,11.5M16,11.5A3.5,3.5 0 0,0 19.5,8A3.5,3.5 0 0,0 16,4.5A3.5,3.5 0 0,0 12.5,8A3.5,3.5 0 0,0 16,11.5Z</Geometry>
        <Geometry x:Key="IconSettings">M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M12,22C11.6,22 11.2,21.9 10.8,21.7L9.1,20.9C5.1,19.3 2,15.2 2,10.9V5L12,2L22,5V10.9C22,15.2 18.9,19.3 14.9,20.9L13.2,21.7C12.8,21.9 12.4,22 12,22Z</Geometry>

        <Geometry x:Key="IconReport">M10,17L6,21H18L14,17H10M10,10H14V15H10V10M4,3H20C21.1,3 22,3.9 22,5V17C22,18.1 21.1,19 20,19H4C2.9,19 2,18.1 2,17V5C2,3.9 2.9,3 4,3Z</Geometry>

        <Style x:Key="HeaderTextBlock" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{StaticResource DarkBrownBrush}"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
        </Style>
        <Style x:Key="CardBorder" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource WhiteTextBrush}"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect ShadowDepth="1" Color="#000" Opacity="0.08" BlurRadius="20"/>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBrownBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource WhiteTextBrush}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" CornerRadius="4" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource DarkBrownBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="DataGridRow" x:Key="StockDataGridRowStyle">
            <Setter Property="Background" Value="Transparent"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding TinhTrang}" Value="Hết hàng">
                    <Setter Property="Background" Value="{StaticResource StatusRedBrush}"/>
                    <Setter Property="Foreground" Value="{StaticResource ActionRedBrush}"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding TinhTrang}" Value="Sắp hết">
                    <Setter Property="Background" Value="{StaticResource StatusYellowBrush}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Page.Resources>

    <Grid Background="{StaticResource LightCreamBrush}" x:Name="MainPanel" Margin="10" >
        <Grid.RenderTransform>
            <TranslateTransform Y="20"/>
        </Grid.RenderTransform>
        <Grid.Triggers>
        </Grid.Triggers>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" Style="{StaticResource CardBorder}" Margin="0,0,0,15">
                <WrapPanel Orientation="Horizontal">
                    <Button x:Name="btnGoToTonKho" Style="{StaticResource PrimaryButton}" Margin="0,0,10,10" IsEnabled="False" Background="{StaticResource DarkBrownBrush}">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconWarehouse}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                            <TextBlock Text="Tồn Kho" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button x:Name="btnGoToNguyenLieu" Style="{StaticResource PrimaryButton}" Margin="0,0,10,10" Click="BtnGoToNguyenLieu_Click">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconSettings}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                            <TextBlock Text="Quản lý Nguyên Liệu" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button x:Name="btnGoToNhapKho" Style="{StaticResource PrimaryButton}" Margin="0,0,10,10" Click="BtnGoToNhapKho_Click">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconBoxIn}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                            <TextBlock Text="Quản lý Nhập Kho" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button x:Name="btnGoToXuatHuy" Style="{StaticResource PrimaryButton}" Margin="0,0,10,10" Click="BtnGoToXuatHuy_Click">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconBoxOut}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                            <TextBlock Text="Quản lý Xuất Hủy" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button x:Name="btnGoToKiemKho" Style="{StaticResource PrimaryButton}" Margin="0,0,10,10" Click="BtnGoToKiemKho_Click">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconChecklist}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                            <TextBlock Text="Quản lý Kiểm Kho" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    <Button x:Name="btnGoToNCC" Style="{StaticResource PrimaryButton}" Margin="0,0,10,10" Click="BtnGoToNCC_Click">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconSupplier}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                            <TextBlock Text="Nhà Cung Cấp" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button x:Name="btnGoToBaoCaoKho" Style="{StaticResource PrimaryButton}" Margin="0,0,10,10" Click="BtnGoToBaoCaoKho_Click" Background="#00724C">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconReport}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                            <TextBlock Text="Xem Báo Cáo Kho" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </WrapPanel>
            </Border>

            <Border Grid.Row="1" Style="{StaticResource CardBorder}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Text="Tất cả Nguyên liệu trong kho" Style="{StaticResource HeaderTextBlock}"/>
                    <DataGrid Grid.Row="1" x:Name="dgTonKho" AutoGenerateColumns="False" IsReadOnly="True" 
                              BorderThickness="0" RowHeaderWidth="0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding IdNguyenLieu}" Width="50"/>
                            <DataGridTextColumn Header="Tên Nguyên liệu" Binding="{Binding TenNguyenLieu}" Width="*"/>
                            <DataGridTextColumn Header="Số lượng tồn" Binding="{Binding TonKho, StringFormat=N2}" Width="150"/>
                            <DataGridTextColumn Header="Đơn vị tính" Binding="{Binding DonViTinh}" Width="150"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>

            <GridSplitter Grid.Row="2" Height="5" HorizontalAlignment="Stretch" Background="Transparent" ResizeBehavior="PreviousAndNext"/>

            <Border Grid.Row="3" Style="{StaticResource CardBorder}" Margin="0,5,0,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Text="Cảnh báo Tồn kho thấp (Tự động)" Style="{StaticResource HeaderTextBlock}" Foreground="{StaticResource ActionRedBrush}"/>
                    <DataGrid Grid.Row="1" x:Name="dgCanhBao" AutoGenerateColumns="False" IsReadOnly="True" 
                              BorderThickness="0" RowHeaderWidth="0"
                              RowStyle="{StaticResource StockDataGridRowStyle}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding IdNguyenLieu}" Width="50"/>
                            <DataGridTextColumn Header="Tên Nguyên liệu" Binding="{Binding TenNguyenLieu}" Width="*"/>
                            <DataGridTextColumn Header="SL Tồn" Binding="{Binding TonKho, StringFormat=N2}" Width="100"/>
                            <DataGridTextColumn Header="ĐVT" Binding="{Binding DonViTinh}" Width="80"/>
                            <DataGridTextColumn Header="Ngưỡng" Binding="{Binding TonKhoToiThieu, StringFormat=N2}" Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>
        </Grid>

        <Border x:Name="LoadingOverlay" Grid.Row="0" Grid.RowSpan="99" Background="#80FFFFFF" Visibility="Collapsed" Panel.ZIndex="100">
            <TextBlock Text="Đang tải..." HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="18" FontWeight="SemiBold" Foreground="{StaticResource DarkBrownBrush}"/>
        </Border>
    </Grid>
</Page>