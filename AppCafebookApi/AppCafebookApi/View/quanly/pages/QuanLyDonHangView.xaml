<Page x:Class="AppCafebookApi.View.quanly.pages.QuanLyDonHangView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:AppCafebookApi.View.quanly.pages"
      mc:Ignorable="d" 
      d:DesignHeight="700" d:DesignWidth="1100"
      Title="QuanLyDonHangView" FontFamily="Segoe UI" Loaded="Page_Loaded">

    <Page.Resources>
        <SolidColorBrush x:Key="PrimaryBrownBrush" Color="#6F4E37"/>
        <SolidColorBrush x:Key="DarkBrownBrush" Color="#4E342E"/>
        <SolidColorBrush x:Key="LightCreamBrush" Color="#FFF8E1"/>
        <SolidColorBrush x:Key="WhiteTextBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextGrayBrush" Color="#757575"/>
        <SolidColorBrush x:Key="BorderGrayBrush" Color="#E0E0E0"/>
        <SolidColorBrush x:Key="ActionBlueBrush" Color="#42A5F5"/>
        <SolidColorBrush x:Key="StatusGreenBrush" Color="#66BB6A"/>
        <SolidColorBrush x:Key="StatusRedBrush" Color="#EF5350"/>
        <SolidColorBrush x:Key="StatusBlueBrush" Color="#42A5F5"/>
        <SolidColorBrush x:Key="StatusYellowBrush" Color="#FFF9C4"/>
        <SolidColorBrush x:Key="StatusCanceledBrush" Color="#F5F5F5"/>
        <SolidColorBrush x:Key="ActionRedBrush" Color="#EF5350"/>

        
        <Geometry x:Key="IconFilter">M14,12V19.88C14.04,20.18 13.94,20.5 13.71,20.71C13.32,21.1 12.69,21.1 12.3,20.71L10.29,18.7C10.06,18.47 9.96,18.16 10,17.87V12H14M15,9H9V4H15V9Z</Geometry>
        <Geometry x:Key="IconFilterOff">M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z</Geometry>
        <Geometry x:Key="IconPrint">M19,8H5C3.34,8 2,9.34 2,11V17H6V21H18V17H22V11C22,9.34 20.66,8 19,8M16,19H8V14H16V19M19,12C18.45,12 18,11.55 18,11C18,10.45 18.45,10 19,10C19.55,10 20,10.45 20,11C20,11.55 19.55,12 19,12M18,3H6V7H18V3Z</Geometry>
        <Geometry x:Key="IconCancel">M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z</Geometry>
        <Geometry x:Key="IconDelivery">M16,11H12.5V8H8V14H10V11H10.5L12.5,13L14.5,11H16M20,8H17V6H10V8H7L3,12V18H5V20H7V18H17V20H19V18H21V12L20,8Z</Geometry>
        <Geometry x:Key="IconExcel">M21.17 3.25Q21.5 3.25 21.76 3.5 22 3.74 22 4.08V19.92Q22 20.26 21.76 20.5 21.5 20.75 21.17 20.75H7.83Q7.5 20.75 7.24 20.5 7 20.26 7 19.92V4.08Q7 3.74 7.24 3.5 7.5 3.25 7.83 3.25H21.17M13.83 18.25V15.7H11.5V14.05L13.72 10.63H11.6V9H16.33V10.65L14.12 14.07H16.25V15.7H13.83V18.25M6.25 15.5Q6.25 15.15 6.04 14.88 5.82 14.6 5.5 14.6H3.5Q3.18 14.6 2.96 14.88 2.75 15.15 2.75 15.5V17.5Q2.75 17.82 2.96 18.1 3.18 18.38 3.5 18.38H5.5Q5.82 18.38 6.04 18.1 6.25 17.82 6.25 17.5V15.5M6.25 9.5Q6.25 9.18 6.04 8.9 5.82 8.62 5.5 8.62H3.5Q3.18 8.62 2.96 8.9 2.75 9.18 2.75 9.5V11.5Q2.75 11.82 2.96 12.1 3.18 12.38 3.5 12.38H5.5Q5.82 12.38 6.04 12.1 6.25 11.82 6.25 11.5V9.5Z</Geometry>

        <Style x:Key="HeaderTextBlock" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{StaticResource DarkBrownBrush}"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
        </Style>
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBrownBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource WhiteTextBrush}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" CornerRadius="4" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource DarkBrownBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DataGridRowStyle" TargetType="DataGridRow">
            <Setter Property="Background" Value="Transparent"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding TrangThai}" Value="Đã thanh toán">
                    <Setter Property="Background" Value="{StaticResource StatusGreenBrush}"/>
                    <Setter Property="Opacity" Value="0.7"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding TrangThai}" Value="Chưa thanh toán">
                    <Setter Property="Background" Value="{StaticResource StatusYellowBrush}"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding LoaiHoaDon}" Value="Giao hàng">
                    <Setter Property="Background" Value="{StaticResource StatusBlueBrush}"/>
                    <Setter Property="Opacity" Value="0.6"/>
                </DataTrigger>
                <DataTrigger Binding="{Binding TrangThai}" Value="Đã hủy">
                    <Setter Property="Background" Value="{StaticResource StatusCanceledBrush}"/>
                    <Setter Property="Foreground" Value="{StaticResource TextGrayBrush}"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

    </Page.Resources>

    <Grid Background="{StaticResource LightCreamBrush}" x:Name="MainPanel" >
        <Grid.RenderTransform>
            <TranslateTransform Y="20"/>
        </Grid.RenderTransform>
        <Grid.Triggers>
        </Grid.Triggers>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Background="{StaticResource WhiteTextBrush}" CornerRadius="8" Padding="15" Margin="15,15,15,0">
            <Border.Effect>
                <DropShadowEffect ShadowDepth="1" Color="#000" Opacity="0.08" BlurRadius="20"/>
            </Border.Effect>
            <WrapPanel Orientation="Horizontal">
                <TextBlock Text="Từ ngày:" VerticalAlignment="Center" FontWeight="SemiBold" Foreground="{StaticResource DarkBrownBrush}" Margin="5"/>
                <DatePicker x:Name="dpTuNgay" Width="130" Margin="5" VerticalContentAlignment="Center"/>
                <TextBlock Text="Đến ngày:" VerticalAlignment="Center" FontWeight="SemiBold" Foreground="{StaticResource DarkBrownBrush}" Margin="10,5,5,5"/>
                <DatePicker x:Name="dpDenNgay" Width="130" Margin="5" VerticalContentAlignment="Center"/>

                <TextBlock Text="Trạng thái:" VerticalAlignment="Center" FontWeight="SemiBold" Foreground="{StaticResource DarkBrownBrush}" Margin="10,5,5,5"/>
                <ComboBox x:Name="cmbTrangThai" Width="140" Margin="5" VerticalContentAlignment="Center">
                    <ComboBoxItem Content="Tất cả"/>
                    <ComboBoxItem Content="Chưa thanh toán"/>
                    <ComboBoxItem Content="Đã thanh toán"/>
                    <ComboBoxItem Content="Đã hủy"/>
                </ComboBox>

                <TextBlock Text="Nhân viên:" VerticalAlignment="Center" FontWeight="SemiBold" Foreground="{StaticResource DarkBrownBrush}" Margin="10,5,5,5"/>
                <ComboBox x:Name="cmbNhanVien" Width="140" Margin="5" DisplayMemberPath="Ten" SelectedValuePath="Id" VerticalContentAlignment="Center"/>

                <TextBlock Text="Tìm kiếm (Mã HĐ, SĐT):" VerticalAlignment="Center" FontWeight="SemiBold" Foreground="{StaticResource DarkBrownBrush}" Margin="10,5,5,5"/>
                <TextBox x:Name="txtSearch" Width="150" Margin="5" VerticalContentAlignment="Center" BorderThickness="0,0,0,1" Background="Transparent"/>

                <Button x:Name="btnLoc" Margin="10,5,5,5" Style="{StaticResource PrimaryButton}" Click="BtnLoc_Click" Width="80">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="{StaticResource IconFilter}" Fill="White" Width="14" Height="14" Margin="0,0,8,0" Stretch="Uniform"/>
                        <TextBlock Text="Lọc" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
                <Button x:Name="btnXoaLoc" Margin="5" Style="{StaticResource PrimaryButton}" Background="White" Foreground="{StaticResource TextGrayBrush}" BorderBrush="{StaticResource BorderGrayBrush}" BorderThickness="1" Click="BtnXoaLoc_Click">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="{StaticResource IconFilterOff}" Fill="{StaticResource TextGrayBrush}" Width="14" Height="14" Margin="0,0,8,0" Stretch="Uniform"/>
                        <TextBlock Text="Xóa lọc" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
                <Button x:Name="btnNavigate_PhuThu" 
                        Margin="15,5,5,5" 
                        Style="{StaticResource PrimaryButton}" 
                        Background="{StaticResource ActionBlueBrush}" 
                        Click="BtnNavigate_PhuThu_Click" 
                        Width="140">
                    <TextBlock Text="Quản lý Phụ thu" VerticalAlignment="Center"/>
                </Button>
            </WrapPanel>
        </Border>
        <Grid Grid.Row="1" Margin="15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="{StaticResource WhiteTextBrush}" CornerRadius="8">
                <Border.Effect>
                    <DropShadowEffect ShadowDepth="1" Color="#000" Opacity="0.08" BlurRadius="20"/>
                </Border.Effect>
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="Danh sách Đơn hàng" Style="{StaticResource HeaderTextBlock}"/>

                    <DataGrid Grid.Row="1" x:Name="dgDonHang" AutoGenerateColumns="False" IsReadOnly="True" 
                              SelectionMode="Single" SelectionChanged="DgDonHang_SelectionChanged"
                              BorderThickness="0" RowHeaderWidth="0"
                              RowStyle="{StaticResource DataGridRowStyle}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Mã HĐ" Binding="{Binding IdHoaDon}" Width="60"/>
                            <DataGridTextColumn Header="Thời gian" Binding="{Binding ThoiGianTao, StringFormat='dd/MM HH:mm'}" Width="110"/>
                            <DataGridTextColumn Header="Nhân viên" Binding="{Binding TenNhanVien}" Width="*"/>
                            <DataGridTextColumn Header="Khách hàng" Binding="{Binding TenKhachHang}" Width="*"/>
                            <DataGridTextColumn Header="Bàn/Loại" Binding="{Binding SoBan}" Width="100"/>
                            <DataGridTextColumn Header="Thành tiền" Binding="{Binding ThanhTien, StringFormat=N0}" Width="100"/>
                            <DataGridTextColumn Header="Trạng thái" Binding="{Binding TrangThai}" Width="110"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <Button Grid.Row="2" x:Name="btnExportToExcel" HorizontalAlignment="Left" Margin="0,15,0,0"
                                Style="{StaticResource PrimaryButton}" Background="#00724C"
                                Click="BtnExportToExcel_Click">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconExcel}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                            <TextBlock Text="Xuất Excel" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                </Grid>
            </Border>

            <Border Grid.Column="1" Background="{StaticResource WhiteTextBrush}" CornerRadius="8" Margin="15,0,0,0" Padding="20">
                <Border.Effect>
                    <DropShadowEffect ShadowDepth="1" Color="#000" Opacity="0.08" BlurRadius="20"/>
                </Border.Effect>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="Chi tiết Đơn hàng" FontSize="18" FontWeight="Bold" Foreground="{StaticResource DarkBrownBrush}" Margin="0,0,0,15"/>

                    <TextBlock Grid.Row="1" Text="Món ăn" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <DataGrid Grid.Row="2" x:Name="dgChiTietDonHang" AutoGenerateColumns="False" IsReadOnly="True" Background="Transparent" BorderThickness="0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Sản phẩm" Binding="{Binding TenSanPham}" Width="*"/>
                            <DataGridTextColumn Header="SL" Binding="{Binding SoLuong}" Width="40"/>
                            <DataGridTextColumn Header="Thành tiền" Binding="{Binding ThanhTien, StringFormat=N0}" Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <TextBlock Grid.Row="3" Text="Phụ thu" FontWeight="SemiBold" Margin="0,10,0,5"/>
                    <ItemsControl Grid.Row="4" x:Name="icPhuThuChiTiet" Margin="0,0,0,15">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <TextBlock Text="{Binding TenPhuThu}" HorizontalAlignment="Left" Foreground="Gray"/>
                                    <TextBlock Text="{Binding SoTien, StringFormat=+ {0:N0}}" HorizontalAlignment="Right" Foreground="Gray"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <StackPanel Grid.Row="5" Margin="0,15,0,0">
                        <Button x:Name="btnInLaiHoaDon" Style="{StaticResource PrimaryButton}" Background="{StaticResource ActionBlueBrush}" IsEnabled="False" Click="BtnInLaiHoaDon_Click" Height="40">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="{StaticResource IconPrint}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                                <TextBlock Text="In lại Hóa đơn" VerticalAlignment="Center" Margin="0,1,0,0"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="btnGiaoHang" Margin="0,8,0,0" Style="{StaticResource PrimaryButton}" Background="{StaticResource ActionBlueBrush}" IsEnabled="False" Click="BtnGiaoHang_Click" Height="40">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="{StaticResource IconDelivery}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                                <TextBlock Text="Bắt đầu Giao Hàng" VerticalAlignment="Center" Margin="0,1,0,0"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="btnHuyDonHang" Margin="0,8,0,0" Style="{StaticResource PrimaryButton}" Background="{StaticResource ActionRedBrush}" IsEnabled="False" Click="BtnHuyDonHang_Click" Height="40">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="{StaticResource IconCancel}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                                <TextBlock Text="Hủy Đơn hàng" VerticalAlignment="Center" Margin="0,1,0,0"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</Page>