<Page x:Class="AppCafebookApi.View.quanly.pages.QuanLyKhachHangView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:AppCafebookApi.View.quanly.pages"
      mc:Ignorable="d" 
      d:DesignHeight="700" d:DesignWidth="1100"
      Title="Quản lý Khách hàng" FontFamily="Segoe UI" Loaded="Page_Loaded"
      Background="#FFF8E1">

    <Page.Resources>
        <SolidColorBrush x:Key="PrimaryBrownBrush" Color="#6F4E37"/>
        <SolidColorBrush x:Key="DarkBrownBrush" Color="#4E342E"/>
        <SolidColorBrush x:Key="AccentOrangeBrush" Color="#D27D2D"/>
        <SolidColorBrush x:Key="LightCreamBrush" Color="#FFF8E1"/>
        <SolidColorBrush x:Key="WhiteTextBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextGrayBrush" Color="#757575"/>
        <SolidColorBrush x:Key="BorderGrayBrush" Color="#BDBDBD"/>
        <SolidColorBrush x:Key="ActionGreenBrush" Color="#66BB6A"/>
        <SolidColorBrush x:Key="ActionRedBrush" Color="#EF5350"/>
        <SolidColorBrush x:Key="ActionBlueBrush" Color="#42A5F5"/>
        <SolidColorBrush x:Key="SubtleGrayBrush" Color="#F5F5F5"/>
        <SolidColorBrush x:Key="StatusYellowBrush" Color="#FFF9C4"/>
        <SolidColorBrush x:Key="StatusCanceledBrush" Color="#F5F5F5"/>
        <SolidColorBrush x:Key="StatusGreenBrush" Color="#E8F5E9"/>

        <Geometry x:Key="IconNew">M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20,12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z</Geometry>
        <Geometry x:Key="IconAdd">M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z</Geometry>
        <Geometry x:Key="IconSave">M17,3H5C3.89,3 3,3.9 3,5V19C3,20.1 3.9,21 5,21H19C20.1,21 21,20.1 21,19V7L17,3M15,9H5V5H15V9M12,19C10.34,19 9,17.66 9,16C9,14.34 10.34,13 12,13C13.66,13 15,14.34 15,16C15,17.66 13.66,19 12,19Z</Geometry>
        <Geometry x:Key="IconDelete">M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19V4M6,19C6,20.1 6.9,21 8,21H16C17.1,21 18,20.1 18,19V7H6V19Z</Geometry>
        <Geometry x:Key="IconUpload">M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z</Geometry>
        <Geometry x:Key="IconLock">M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8H17V6A5,5 0 0,0 12,1A5,5 0 0,0 7,6V8H6A2,2 0 0,0 4,10V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V10A2,2 0 0,0 18,8Z</Geometry>
        <Geometry x:Key="IconUnlock">M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8H17V6A5,5 0 0,0 12,1A5,5 0 0,0 7,6H9V8H18V10H20V20H4V10H6V8H7A5,5 0 0,0 12,1Z</Geometry>
        <Geometry x:Key="IconExcel">M21.17 3.25Q21.5 3.25 21.76 3.5 22 3.74 22 4.08V19.92Q22 20.26 21.76 20.5 21.5 20.75 21.17 20.75H7.83Q7.5 20.75 7.24 20.5 7 20.26 7 19.92V4.08Q7 3.74 7.24 3.5 7.5 3.25 7.83 3.25H21.17M13.83 18.25V15.7H11.5V14.05L13.72 10.63H11.6V9H16.33V10.65L14.12 14.07H16.25V15.7H13.83V18.25M6.25 15.5Q6.25 15.15 6.04 14.88 5.82 14.6 5.5 14.6H3.5Q3.18 14.6 2.96 14.88 2.75 15.15 2.75 15.5V17.5Q2.75 17.82 2.96 18.1 3.18 18.38 3.5 18.38H5.5Q5.82 18.38 6.04 18.1 6.25 17.82 6.25 17.5V15.5M6.25 9.5Q6.25 9.18 6.04 8.9 5.82 8.62 5.5 8.62H3.5Q3.18 8.62 2.96 8.9 2.75 9.18 2.75 9.5V11.5Q2.75 11.82 2.96 12.1 3.18 12.38 3.5 12.38H5.5Q5.82 12.38 6.04 12.1 6.25 11.82 6.25 11.5V9.5Z</Geometry>
        <Geometry x:Key="IconPromotion">M12.41,2.58C12.03,2.2 11.53,2 11,2H4C2.9,2 2,2.9 2,4V11C2,11.53 2.2,12.03 2.59,12.41L12.42,22.24C12.81,22.63 13.44,22.63 13.83,22.24L22.24,13.82C22.63,13.43 22.63,12.8 22.24,12.41L12.41,2.58M7,7A1.5,1.5 0 0,1 5.5,8.5A1.5,1.5 0 0,1 4,7A1.5,1.5 0 0,1 5.5,5.5A1.5,1.5 0 0,1 7,7Z</Geometry>
        <Geometry x:Key="IconSettings">M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12A2,2 0 0,0 12,10M12,22C11.6,22 11.2,21.9 10.8,21.7L9.1,20.9C5.1,19.3 2,15.2 2,10.9V5L12,2L22,5V10.9C22,15.2 18.9,19.3 14.9,20.9L13.2,21.7C12.8,21.9 12.4,22 12,22Z</Geometry>

        <Style x:Key="HeaderTextBlock" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{StaticResource DarkBrownBrush}"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
        </Style>
        <Style x:Key="CardBorder" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource WhiteTextBrush}"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect ShadowDepth="1" Color="#000000" Opacity="0.08" BlurRadius="20"/>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBrownBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource WhiteTextBrush}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" CornerRadius="4" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource DarkBrownBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="MaterialInput" TargetType="Control">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderGrayBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Background" Value="Transparent"/>
            <Style.Triggers>
                <Trigger Property="IsKeyboardFocused" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrownBrush}"/>
                    <Setter Property="BorderThickness" Value="0,0,0,2"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style TargetType="TextBox" BasedOn="{StaticResource MaterialInput}"/>
        <Style TargetType="ComboBox" BasedOn="{StaticResource MaterialInput}"/>
        <Style TargetType="DatePicker" BasedOn="{StaticResource MaterialInput}"/>
        <Style x:Key="RightAligned" TargetType="TextBlock">
            <Setter Property="TextAlignment" Value="Right"/>
        </Style>
        <Style x:Key="CustomerDataGridRowStyle" TargetType="DataGridRow">
            <Setter Property="Background" Value="Transparent"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding BiKhoa}" Value="True">
                    <Setter Property="Background" Value="#FFEBEE"/>
                    <Setter Property="Foreground" Value="{StaticResource ActionRedBrush}"/>
                    <Setter Property="FontStyle" Value="Italic"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="AvatarImage" TargetType="Image">
            <Setter Property="Width" Value="100"/>
            <Setter Property="Height" Value="100"/>
            <Setter Property="Stretch" Value="UniformToFill"/>
        </Style>

    </Page.Resources>

    <Grid Background="{StaticResource LightCreamBrush}" x:Name="MainPanel" Margin="10" >
        <Grid.RenderTransform>
            <TranslateTransform Y="20"/>
        </Grid.RenderTransform>
        <Grid.Triggers>
        </Grid.Triggers>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" Background="{StaticResource WhiteTextBrush}" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                <WrapPanel Orientation="Horizontal">
                    <TextBlock Text="Tìm kiếm (Tên, SĐT, Email):" VerticalAlignment="Center" FontWeight="SemiBold" Foreground="{StaticResource DarkBrownBrush}"/>
                    <TextBox x:Name="txtSearchKhachHang" Width="200" Margin="10,0,0,0" TextChanged="TxtSearchKhachHang_TextChanged"/>
                    <TextBlock Text="Trạng thái:" VerticalAlignment="Center" FontWeight="SemiBold" Foreground="{StaticResource DarkBrownBrush}" Margin="20,0,0,0"/>
                    <ComboBox x:Name="cmbFilterTrangThai" Width="150" Margin="10,0,0,0" SelectionChanged="CmbFilterTrangThai_SelectionChanged">
                        <ComboBoxItem Content="Tất cả" Tag="{x:Null}"/>
                        <ComboBoxItem Content="Đang hoạt động" Tag="False"/>
                        <ComboBoxItem Content="Bị khóa" Tag="True"/>
                    </ComboBox>

                    <Button x:Name="btnExportExcel" Margin="20,0,0,0" Style="{StaticResource PrimaryButton}" Background="#00724C" Click="BtnExportExcel_Click" Padding="10,5">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconExcel}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                            <TextBlock Text="Xuất Excel" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button x:Name="btnGoToKhuyenMai" Margin="10,0,0,0" Style="{StaticResource PrimaryButton}" Background="{StaticResource AccentOrangeBrush}" Click="BtnGoToKhuyenMai_Click" Padding="10,5">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconPromotion}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                            <TextBlock Text="Quản lý Khuyến mãi" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <Button x:Name="btnCaiDatDiem" Margin="10,0,0,0" Style="{StaticResource PrimaryButton}" Background="{StaticResource TextGrayBrush}" Click="BtnCaiDatDiem_Click" Padding="10,5">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="{StaticResource IconSettings}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                            <TextBlock Text="Cài đặt Điểm" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                </WrapPanel>
            </Border>

            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="420"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Margin="0,0,15,0" Style="{StaticResource CardBorder}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Text="Danh sách Khách hàng" Style="{StaticResource HeaderTextBlock}"/>
                        <DataGrid Grid.Row="1" x:Name="dgKhachHang" AutoGenerateColumns="False" IsReadOnly="True" 
                                  SelectionMode="Single" SelectionChanged="DgKhachHang_SelectionChanged"
                                  BorderThickness="0" RowHeaderWidth="0"
                                  RowStyle="{StaticResource CustomerDataGridRowStyle}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ID" Binding="{Binding IdKhachHang}" Width="50"/>
                                <DataGridTextColumn Header="Họ Tên" Binding="{Binding HoTen}" Width="*"/>
                                <DataGridTextColumn Header="Số điện thoại" Binding="{Binding SoDienThoai}" Width="120"/>
                                <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="150"/>
                                <DataGridTextColumn Header="Ngày tạo" Binding="{Binding NgayTao, StringFormat='dd/MM/yyyy'}" Width="100"/>
                                <DataGridTextColumn Header="Trạng thái" Binding="{Binding TrangThai}" Width="100"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Border>

                <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <Border Style="{StaticResource CardBorder}">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock x:Name="lblFormTitle" Text="Thông tin Khách hàng" FontSize="18" FontWeight="Bold" Foreground="{StaticResource DarkBrownBrush}" Margin="0,0,0,15"/>
                                    <Button x:Name="btnLamMoiKH" Grid.Column="1" ToolTip="Tạo mới" Click="BtnLamMoiKH_Click" 
                                            Background="Transparent" BorderThickness="0" Cursor="Hand" Width="40" Height="40">
                                        <Path Data="{StaticResource IconNew}" Fill="{StaticResource TextGrayBrush}" Width="23" Height="23"/>
                                    </Button>
                                </Grid>

                                <Grid Margin="0,0,0,15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Border Grid.Column="0" BorderBrush="{StaticResource BorderGrayBrush}" BorderThickness="1" Width="100" Height="100" Background="{StaticResource SubtleGrayBrush}" CornerRadius="50">
                                        <Ellipse>
                                            <Ellipse.Fill>
                                                <ImageBrush x:Name="AvatarPreview" Stretch="UniformToFill"/>
                                            </Ellipse.Fill>
                                        </Ellipse>
                                    </Border>
                                    <Button x:Name="btnChonAnh" Grid.Column="1" VerticalAlignment="Bottom" HorizontalAlignment="Left" 
                                            Margin="15,0,0,0" Style="{StaticResource PrimaryButton}" Background="#F5F5F5" 
                                            BorderBrush="#E0E0E0" Foreground="{StaticResource DarkBrownBrush}"
                                            Click="BtnChonAnh_Click">
                                        <StackPanel Orientation="Horizontal">
                                            <Path Data="{StaticResource IconUpload}" Fill="{StaticResource DarkBrownBrush}" Width="23" Height="23" Margin="0,0,8,0"/>
                                            <TextBlock Text="Chọn Avatar" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </Grid>

                                <Label Content="Họ tên (*)"/>
                                <TextBox x:Name="txtHoTenKH"/>
                                <Label Content="Số điện thoại (*)"/>
                                <TextBox x:Name="txtSdtKH"/>
                                <Label Content="Email"/>
                                <TextBox x:Name="txtEmailKH"/>
                                <Label Content="Tên đăng nhập (Web)"/>
                                <TextBox x:Name="txtTenDangNhapKH"/>
                                <Label Content="Địa chỉ"/>
                                <TextBox x:Name="txtDiaChiKH"/>
                                <Label Content="Điểm tích lũy"/>
                                <TextBox x:Name="txtDiemTichLuy" IsReadOnly="False"/>

                                <WrapPanel Orientation="Horizontal" Margin="0,20,0,0">
                                    <Button x:Name="btnThemKH" Style="{StaticResource PrimaryButton}" Background="{StaticResource ActionGreenBrush}" Click="BtnThemKH_Click" Margin="0,0,8,0" Padding="15,10">
                                        <TextBlock Text="Thêm Mới"/>
                                    </Button>
                                    <Button x:Name="btnLuuKH" Style="{StaticResource PrimaryButton}" Click="BtnLuuKH_Click" Margin="0,0,8,0" Padding="15,10">
                                        <TextBlock Text="Lưu Thay Đổi"/>
                                    </Button>
                                    <Button x:Name="btnXoaKH" Style="{StaticResource PrimaryButton}" Background="{StaticResource ActionRedBrush}" Click="BtnXoaKH_Click" Padding="15,10">
                                        <TextBlock Text="Xóa"/>
                                    </Button>
                                </WrapPanel>
                                <WrapPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <Button x:Name="btnKhoaKH" Style="{StaticResource PrimaryButton}" Background="{StaticResource AccentOrangeBrush}" Click="BtnKhoaKH_Click" Margin="0,0,8,0" Padding="15,10">
                                        <StackPanel Orientation="Horizontal">
                                            <Path Data="{StaticResource IconLock}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                                            <TextBlock Text="Khóa Tài Khoản" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                    <Button x:Name="btnMoKhoaKH" Style="{StaticResource PrimaryButton}" Background="{StaticResource ActionBlueBrush}" Click="BtnMoKhoaKH_Click" Padding="15,10">
                                        <StackPanel Orientation="Horizontal">
                                            <Path Data="{StaticResource IconUnlock}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                                            <TextBlock Text="Mở Khóa" VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </WrapPanel>
                            </StackPanel>
                        </Border>

                        <Border Style="{StaticResource CardBorder}" Margin="0,20,0,0">
                            <StackPanel>
                                <TextBlock Text="Lịch sử Giao dịch" FontSize="18" FontWeight="Bold" Foreground="{StaticResource DarkBrownBrush}" Margin="0,0,0,10"/>
                                <TextBlock Text="Đơn hàng đã mua:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                                <DataGrid x:Name="dgLichSuDonHang" AutoGenerateColumns="False" IsReadOnly="True" MaxHeight="150" RowHeaderWidth="0">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Mã HĐ" Binding="{Binding IdHoaDon}" Width="60"/>
                                        <DataGridTextColumn Header="Ngày" Binding="{Binding ThoiGianTao, StringFormat='dd/MM/yy'}" Width="80"/>
                                        <DataGridTextColumn Header="Tổng tiền" Binding="{Binding ThanhTien, StringFormat=N0}" Width="*" ElementStyle="{StaticResource RightAligned}"/>
                                        <DataGridTextColumn Header="Trạng thái" Binding="{Binding TrangThai}" Width="100"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                                <TextBlock Text="Sách đã thuê:" FontWeight="SemiBold" Margin="0,10,0,5"/>
                                <DataGrid x:Name="dgLichSuThueSach" AutoGenerateColumns="False" IsReadOnly="True" MaxHeight="150" RowHeaderWidth="0">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Mã Phiếu" Binding="{Binding IdPhieuThue}" Width="70"/>
                                        <DataGridTextColumn Header="Tên Sách" Binding="{Binding TieuDeSach}" Width="*"/>
                                        <DataGridTextColumn Header="Ngày Thuê" Binding="{Binding NgayThue, StringFormat='dd/MM/yy'}" Width="80"/>
                                        <DataGridTextColumn Header="Trạng thái" Binding="{Binding TrangThai}" Width="100"/>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Grid>

        <Border x:Name="LoadingOverlay" Grid.Row="0" Grid.RowSpan="99" Background="#80FFFFFF" Visibility="Collapsed" Panel.ZIndex="100">
            <TextBlock Text="Đang tải..." HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="18" FontWeight="SemiBold" Foreground="{StaticResource DarkBrownBrush}"/>
        </Border>
    </Grid>
</Page>