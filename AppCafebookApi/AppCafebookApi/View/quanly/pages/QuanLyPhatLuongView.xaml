<Page x:Class="AppCafebookApi.View.quanly.pages.QuanLyPhatLuongView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:AppCafebookApi.View.quanly.pages"
      mc:Ignorable="d" 
      d:DesignHeight="700" d:DesignWidth="1100"
      Title="Quản lý Phát Lương"
      FontFamily="Segoe UI"
      Background="#FFF8E1"
      Loaded="Page_Loaded">

    <Page.Resources>
        <SolidColorBrush x:Key="PrimaryBrownBrush" Color="#6F4E37"/>
        <SolidColorBrush x:Key="DarkBrownBrush" 
Color="#4E342E"/>
        <SolidColorBrush x:Key="TextGrayBrush" Color="#757575"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#66BB6A"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#EF5350"/>
        <SolidColorBrush x:Key="BorderGrayBrush" Color="#BDBDBD"/>
        <SolidColorBrush x:Key="ActionBlueBrush" Color="#42A5F5"/>
        <SolidColorBrush x:Key="ActionOrangeBrush" Color="#FFA726"/>
        <SolidColorBrush x:Key="SubtleGrayBrush" Color="#F5F5F5"/>
        <SolidColorBrush x:Key="PrimaryBrown" Color="#6F4E37"/>
        <SolidColorBrush x:Key="AccentOrange" Color="#D27D2D"/>
        <SolidColorBrush x:Key="LightCreamBrush" 
Color="#FFF8E1"/>
        <SolidColorBrush x:Key="WhiteText" Color="#FFFFFF"/>

        <Geometry x:Key="IconBack">M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z</Geometry>
        <Geometry x:Key="IconSearch">M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L21.5,20L20,21.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z</Geometry>
        <Geometry x:Key="IconView">M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z</Geometry>

        <Style x:Key="HeaderTextBlock" TargetType="TextBlock">
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="{StaticResource DarkBrownBrush}"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
        </Style>
        <Style x:Key="CardBorder" TargetType="Border">
            <Setter Property="Background" 
Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect ShadowDepth="1" Color="#000" Opacity="0.08" BlurRadius="20"/>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBrown}"/>
            <Setter Property="Foreground" Value="{StaticResource WhiteText}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Height" 
Value="42"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                CornerRadius="21"
                                Background="{TemplateBinding 
Background}">
                            <Border.Effect>
                                <DropShadowEffect ShadowDepth="2" Color="#6F4E37" Opacity="0.3" 
BlurRadius="10"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource 
AccentOrange}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Opacity" 
Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource BorderGrayBrush}"/>
                                <Setter TargetName="border" Property="Opacity" Value="0.7"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="BackButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource PrimaryBrownBrush}"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderThickness" 
Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style x:Key="MaterialInput" TargetType="Control">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderGrayBrush}"/>
            <Setter Property="BorderThickness" 
Value="0,0,0,1"/>
            <Setter Property="Background" Value="Transparent"/>
            <Style.Triggers>
                <Trigger Property="IsKeyboardFocused" Value="True">
                    <Setter Property="BorderBrush" Value="{StaticResource PrimaryBrownBrush}"/>
                    <Setter Property="BorderThickness" Value="0,0,0,2"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style TargetType="TextBox" BasedOn="{StaticResource MaterialInput}"/>
        <Style TargetType="DatePicker" BasedOn="{StaticResource MaterialInput}"/>
        <Style TargetType="ComboBox" BasedOn="{StaticResource MaterialInput}"/>

        <Style x:Key="IconDataGridButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="15">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource SubtleGrayBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
            <TextBlock Text="Phát Lương &amp; Phiếu Lương Đã Chốt" Style="{StaticResource HeaderTextBlock}" VerticalAlignment="Center" Margin="0,0,0,0"/>
        </StackPanel>

        <Border Grid.Row="1" Style="{StaticResource CardBorder}" Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="Lọc theo kỳ:" VerticalAlignment="Center" FontWeight="SemiBold" Margin="0,0,15,0"/>

                <TextBlock Grid.Column="1" Text="Tháng:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                <ComboBox Grid.Column="2" x:Name="cmbThang" Width="100"/>

                <TextBlock Grid.Column="3" Text="Năm:" VerticalAlignment="Center" Margin="20,0,5,0"/>
                <ComboBox Grid.Column="4" x:Name="cmbNam" Width="100"/>

                <Button Grid.Column="5" x:Name="btnLoc" Style="{StaticResource PrimaryButton}" Click="BtnLoc_Click" HorizontalAlignment="Left" Margin="20,0,0,0" Width="100" Height="38" Padding="0">
                    <StackPanel Orientation="Horizontal">
                        <Path Data="{StaticResource IconSearch}" Fill="White" Width="23" Height="23" Margin="0,0,8,0"/>
                        <TextBlock Text="Lọc" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>

        <Border Grid.Row="2" Style="{StaticResource CardBorder}" Padding="0">
            <DataGrid x:Name="dgPhieuLuong" AutoGenerateColumns="False" IsReadOnly="True" 
                      SelectionMode="Single"
                      BorderThickness="0" RowHeaderWidth="0" 
                      Background="White"
                      RowStyle="{StaticResource {x:Type DataGridRow}}"
                      CellStyle="{StaticResource {x:Type DataGridCell}}"
                      ColumnHeaderStyle="{StaticResource {x:Type DataGridColumnHeader}}">

                <DataGrid.Columns>
                    <DataGridTextColumn Header="Nhân viên" Binding="{Binding HoTenNhanVien}" Width="2*"/>
                    <DataGridTextColumn Header="Kỳ Lương" Width="Auto">
                        <DataGridTextColumn.Binding>
                            <MultiBinding StringFormat="{}{0}/{1}">
                                <Binding Path="Thang"/>
                                <Binding Path="Nam"/>
                            </MultiBinding>
                        </DataGridTextColumn.Binding>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="Tổng Giờ" Binding="{Binding TongGioLam, StringFormat=F2}" Width="Auto"/>
                    <DataGridTextColumn Header="Thực Lãnh" Binding="{Binding ThucLanh, StringFormat=N0}" Width="1.2*"/>
                    <DataGridTextColumn Header="Ngày Chốt" Binding="{Binding NgayChot, StringFormat='dd/MM/yyyy HH:mm'}" Width="1.5*"/>

                    <DataGridTemplateColumn Header="Trạng Thái" Width="1.2*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding TrangThai}" FontWeight="SemiBold" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="10,0,0,0">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding TrangThai}" Value="Đã phát">
                                                    <Setter Property="Foreground" Value="{StaticResource SuccessBrush}"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding TrangThai}" Value="Đã chốt">
                                                    <Setter Property="Foreground" Value="{StaticResource ActionOrangeBrush}"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTemplateColumn Header="Xem" Width="60">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button x:Name="btnXemChiTiet" Style="{StaticResource IconDataGridButton}" ToolTip="Xem chi tiết &amp; Phát lương" 
                                        Click="BtnXemChiTiet_Click">
                                    <Path Data="{StaticResource IconView}" Fill="{StaticResource ActionBlueBrush}" Width="23" Height="23"/>
                                </Button>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <Button x:Name="btnQuayLai" Grid.Row="3" 
                Style="{StaticResource BackButton}"
                HorizontalAlignment="Left" Margin="0,10,0,0"
                Click="BtnQuayLai_Click">
            <StackPanel Orientation="Horizontal">
                <Path Data="{StaticResource IconBack}" Fill="{StaticResource PrimaryBrownBrush}" Width="23" Height="23" Margin="0,0,5,0"/>
                <TextBlock Text="Quay lại" VerticalAlignment="Center"/>
            </StackPanel>
        </Button>

        <Border x:Name="LoadingOverlay" Grid.Row="0" Grid.RowSpan="99" Background="#80FFFFFF" Visibility="Collapsed" Panel.ZIndex="100">
            <TextBlock Text="Đang tải dữ liệu..." HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="18" FontWeight="SemiBold" Foreground="{StaticResource DarkBrownBrush}"/>
        </Border>
    </Grid>
</Page>