# ğŸ“š â€œThuÃª sÃ¡châ€ vÃ  â˜• â€œGá»i mÃ³n / Äáº·t thá»©c uá»‘ngâ€
---
# ğŸ§¾ Äáº¶C Táº¢ CHI TIáº¾T CHá»¨C NÄ‚NG Há»† THá»NG CAFÃ‰BOOK
---
## ğŸ”· 1. Giá»›i thiá»‡u chung
**TÃªn há»‡ thá»‘ng:** *Cafebook Management System*
**MÃ´ táº£ tá»•ng quÃ¡t:**
Há»‡ thá»‘ng há»— trá»£ khÃ¡ch hÃ ng **thuÃª sÃ¡ch Ä‘á»ƒ Ä‘á»c táº¡i quÃ¡n hoáº·c mang vá»**, Ä‘á»“ng thá»i **Ä‘áº·t mÃ³n / thá»©c uá»‘ng**.
Cáº£ hai nghiá»‡p vá»¥ Ä‘Æ°á»£c **quáº£n lÃ½ tÃ¡ch biá»‡t** nhÆ°ng dÃ¹ng **chung thÃ´ng tin khÃ¡ch hÃ ng, nhÃ¢n viÃªn, vÃ  thanh toÃ¡n**.
---
## ğŸ”· 2. Danh sÃ¡ch chá»©c nÄƒng chÃ­nh
| MÃ£ chá»©c nÄƒng | TÃªn chá»©c nÄƒng               | MÃ´ táº£ ngáº¯n                                                              |
| ------------ | --------------------------- | ----------------------------------------------------------------------- |
| FS-01        | Quáº£n lÃ½ thuÃª sÃ¡ch           | KhÃ¡ch hÃ ng thuÃª 1 hoáº·c nhiá»u sÃ¡ch, cÃ³ thá»ƒ giao táº­n nÆ¡i, cÃ³ thá»i háº¡n tráº£ |
| FS-02        | Quáº£n lÃ½ Ä‘áº·t mÃ³n / thá»©c uá»‘ng | KhÃ¡ch hÃ ng gá»i mÃ³n táº¡i quÃ¡n hoáº·c Ä‘áº·t giao hÃ ng                          |
| FS-03        | Quáº£n lÃ½ thanh toÃ¡n          | Thanh toÃ¡n cá»c sÃ¡ch hoáº·c hÃ³a Ä‘Æ¡n mÃ³n                                    |
| FS-04        | Theo dÃµi vÃ  xá»­ lÃ½ Ä‘Æ¡n hÃ ng  | NhÃ¢n viÃªn quáº£n lÃ½, xÃ¡c nháº­n, cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Æ¡n                    |
---
## ğŸ§© 3. Äáº¶C Táº¢ CHá»¨C NÄ‚NG CHI TIáº¾T
---
## ğŸ“š **CHá»¨C NÄ‚NG FS-01: THUÃŠ SÃCH**
#### 1ï¸âƒ£ Má»¥c Ä‘Ã­ch
Cho phÃ©p khÃ¡ch hÃ ng **thuÃª má»™t hoáº·c nhiá»u quyá»ƒn sÃ¡ch** tá»« quÃ¡n CafÃ©book Ä‘á»ƒ Ä‘á»c táº¡i chá»— hoáº·c mang vá».
CÃ³ thá»ƒ chá»n giao táº­n nÆ¡i, thanh toÃ¡n tiá»n cá»c, vÃ  theo dÃµi phiáº¿u thuÃª.
---
#### 2ï¸âƒ£ Actor liÃªn quan
| Actor               | Vai trÃ²                              |
| ------------------- | ------------------------------------ |
| KhÃ¡ch hÃ ng          | Chá»n sÃ¡ch, xÃ¡c nháº­n thuÃª, thanh toÃ¡n |
| NhÃ¢n viÃªn kho sÃ¡ch  | XÃ¡c nháº­n Ä‘Æ¡n, chuáº©n bá»‹ sÃ¡ch          |
| NhÃ¢n viÃªn giao hÃ ng | Giao sÃ¡ch Ä‘áº¿n khÃ¡ch náº¿u cáº§n          |
| Quáº£n lÃ½ / Thu ngÃ¢n  | XÃ¡c nháº­n thanh toÃ¡n, xá»­ lÃ½ tráº£ sÃ¡ch  |
---
#### 3ï¸âƒ£ Tiá»n Ä‘iá»u kiá»‡n
* KhÃ¡ch hÃ ng **Ä‘Ã£ Ä‘Äƒng nháº­p há»‡ thá»‘ng.**
* SÃ¡ch **cÃ²n tá»“n kho** (`soLuongHienCo > 0`).
* TÃ i khoáº£n khÃ¡ch **khÃ´ng bá»‹ khÃ³a** (`BiKhoa = 0`).
---
#### 4ï¸âƒ£ Háº­u Ä‘iá»u kiá»‡n
* Phiáº¿u thuÃª Ä‘Æ°á»£c táº¡o trong báº£ng `PhieuThueSach`.
* CÃ¡c sÃ¡ch Ä‘Æ°á»£c trá»« tá»“n (`soLuongHienCo`).
* Thanh toÃ¡n cá»c Ä‘Æ°á»£c ghi nháº­n (náº¿u cÃ³).
--
#### 5ï¸âƒ£ Luá»“ng hoáº¡t Ä‘á»™ng chÃ­nh
| BÆ°á»›c | MÃ´ táº£ hÃ nh Ä‘á»™ng                                              | Há»‡ thá»‘ng xá»­ lÃ½                                                |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------- |
| 1    | KhÃ¡ch hÃ ng chá»n 1 hoáº·c nhiá»u sÃ¡ch tá»« danh má»¥c                | Hiá»ƒn thá»‹ thÃ´ng tin chi tiáº¿t sÃ¡ch (giÃ¡ cá»c, mÃ´ táº£, tÃ¬nh tráº¡ng) |
| 2    | Nháº¥n â€œThuÃª sÃ¡châ€                                             | Má»Ÿ form nháº­p thÃ´ng tin thuÃª                                   |
| 3    | Nháº­p hÃ¬nh thá»©c nháº­n: â€œTáº¡i quÃ¡nâ€ hoáº·c â€œGiao táº­n nÆ¡iâ€          | Náº¿u giao táº­n nÆ¡i â†’ yÃªu cáº§u Ä‘á»‹a chá»‰ vÃ  sá»‘ Ä‘iá»‡n thoáº¡i           |
| 4    | Chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n: COD / Chuyá»ƒn khoáº£n / VÃ­ Ä‘iá»‡n tá»­ | LÆ°u lá»±a chá»n                                                  |
| 5    | Nháº¥n â€œXÃ¡c nháº­n thuÃªâ€                                         | Táº¡o báº£n ghi `PhieuThueSach`, `ChiTietPhieuThue`               |
| 6    | Há»‡ thá»‘ng trá»« sÃ¡ch khá»i kho, gá»­i thÃ´ng bÃ¡o                    | Hiá»ƒn thá»‹ thÃ´ng tin háº¡n tráº£                                    |
| 7    | NhÃ¢n viÃªn xÃ¡c nháº­n Ä‘Æ¡n                                       | Cáº­p nháº­t `trangThai = Äang xá»­ lÃ½ / Äang giao / ÄÃ£ tráº£`        |
---
#### 6ï¸âƒ£ CÃ¡c luá»“ng phá»¥
* **Luá»“ng lá»—i 1:** SÃ¡ch háº¿t hÃ ng â†’ hiá»ƒn thá»‹ thÃ´ng bÃ¡o.
* **Luá»“ng lá»—i 2:** KhÃ¡ch chÆ°a Ä‘Äƒng nháº­p â†’ chuyá»ƒn Ä‘áº¿n trang Login.
* **Luá»“ng lá»—i 3:** Thanh toÃ¡n tháº¥t báº¡i â†’ há»§y phiáº¿u, hoÃ n kho.
---
#### 7ï¸âƒ£ Dá»¯ liá»‡u chÃ­nh
| Báº£ng                | MÃ´ táº£                      |
| ------------------- | -------------------------- |
| `PhieuThueSach`     | ThÃ´ng tin phiáº¿u thuÃª tá»•ng  |
| `ChiTietPhieuThue`  | Danh sÃ¡ch sÃ¡ch thuÃª        |
| `ThanhToanThueSach` | ThÃ´ng tin thanh toÃ¡n       |
| `Sach`              | Dá»¯ liá»‡u sÃ¡ch, sá»‘ lÆ°á»£ng tá»“n |
---
#### 8ï¸âƒ£ Tráº¡ng thÃ¡i phiáº¿u thuÃª
| Tráº¡ng thÃ¡i   | MÃ´ táº£                   |
| ------------ | ----------------------- |
| Chá» xÃ¡c nháº­n | ÄÆ¡n má»›i táº¡o             |
| Äang giao    | Äang gá»­i sÃ¡ch Ä‘áº¿n khÃ¡ch |
| Äang thuÃª    | KhÃ¡ch Ä‘ang giá»¯ sÃ¡ch     |
| ÄÃ£ tráº£       | ÄÃ£ hoÃ n táº¥t             |
| ÄÃ£ há»§y       | ÄÆ¡n bá»‹ há»§y              |
---
### â˜• **CHá»¨C NÄ‚NG FS-02: Gá»ŒI MÃ“N / Äáº¶T THá»¨C Uá»NG**
#### 1ï¸âƒ£ Má»¥c Ä‘Ã­ch
Cho phÃ©p khÃ¡ch hÃ ng **Ä‘áº·t mÃ³n, thá»©c uá»‘ng hoáº·c Ä‘á»“ Äƒn nháº¹** tá»« menu CafÃ©book, cÃ³ thá»ƒ dÃ¹ng táº¡i quÃ¡n hoáº·c giao táº­n nÆ¡i.
---
#### 2ï¸âƒ£ Actor liÃªn quan
| Actor                   | Vai trÃ²                        |
| ----------------------- | ------------------------------ |
| KhÃ¡ch hÃ ng              | Chá»n mÃ³n, Ä‘áº·t hÃ ng, thanh toÃ¡n |
| NhÃ¢n viÃªn pha cháº¿ / báº¿p | Chuáº©n bá»‹ mÃ³n theo Ä‘Æ¡n          |
| NhÃ¢n viÃªn giao hÃ ng     | Giao mÃ³n cho khÃ¡ch             |
| Thu ngÃ¢n                | XÃ¡c nháº­n thanh toÃ¡n            |
---
#### 3ï¸âƒ£ Tiá»n Ä‘iá»u kiá»‡n
* KhÃ¡ch hÃ ng **Ä‘Äƒng nháº­p thÃ nh cÃ´ng**.
* MÃ³n Äƒn / thá»©c uá»‘ng **cÃ²n kinh doanh** (`trangThai = 'CÃ²n bÃ¡n'`).
---
#### 4ï¸âƒ£ Háº­u Ä‘iá»u kiá»‡n
* Táº¡o báº£n ghi `HoaDon` vÃ  `ChiTietHoaDon`.
* MÃ³n Ä‘Æ°á»£c gá»­i Ä‘áº¿n quáº§y pha cháº¿.
* Tráº¡ng thÃ¡i hÃ³a Ä‘Æ¡n Ä‘Æ°á»£c cáº­p nháº­t.
---
#### 5ï¸âƒ£ Luá»“ng hoáº¡t Ä‘á»™ng chÃ­nh
| BÆ°á»›c | MÃ´ táº£ hÃ nh Ä‘á»™ng                                     | Há»‡ thá»‘ng xá»­ lÃ½                             |
| ---- | --------------------------------------------------- | ------------------------------------------ |
| 1    | KhÃ¡ch chá»n mÃ³n tá»« menu                              | Hiá»ƒn thá»‹ thÃ´ng tin chi tiáº¿t, giÃ¡, hÃ¬nh áº£nh |
| 2    | Chá»n sá»‘ lÆ°á»£ng vÃ  thÃªm vÃ o giá» hÃ ng                  | Cáº­p nháº­t tá»•ng táº¡m tÃ­nh                     |
| 3    | Chá»n hÃ¬nh thá»©c dÃ¹ng: táº¡i quÃ¡n / giao táº­n nÆ¡i        | Hiá»ƒn thá»‹ Ã´ nháº­p Ä‘á»‹a chá»‰ náº¿u giao           |
| 4    | Chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n (COD / CK / VÃ­ Ä‘iá»‡n tá»­) | LÆ°u lá»±a chá»n                               |
| 5    | XÃ¡c nháº­n Ä‘áº·t hÃ ng                                   | Há»‡ thá»‘ng táº¡o `HoaDon`, `ChiTietHoaDon`     |
| 6    | Chuyá»ƒn Ä‘Æ¡n Ä‘áº¿n pha cháº¿                              | Cáº­p nháº­t tráº¡ng thÃ¡i `Äang pha cháº¿`         |
| 7    | MÃ³n hoÃ n táº¥t â†’ giao hÃ ng hoáº·c phá»¥c vá»¥               | Tráº¡ng thÃ¡i `HoÃ n táº¥t`                      |
---
#### 6ï¸âƒ£ CÃ¡c luá»“ng phá»¥
* **Luá»“ng lá»—i 1:** MÃ³n háº¿t â†’ hiá»ƒn thá»‹ thÃ´ng bÃ¡o.
* **Luá»“ng lá»—i 2:** Giao hÃ ng tháº¥t báº¡i â†’ cáº­p nháº­t tráº¡ng thÃ¡i â€œÄÃ£ há»§yâ€.
* **Luá»“ng lá»—i 3:** Thanh toÃ¡n lá»—i â†’ xÃ³a hÃ³a Ä‘Æ¡n.
---
#### 7ï¸âƒ£ Dá»¯ liá»‡u chÃ­nh
| Báº£ng              | MÃ´ táº£                      |
| ----------------- | -------------------------- |
| `HoaDon`          | LÆ°u thÃ´ng tin hÃ³a Ä‘Æ¡n mÃ³n  |
| `ChiTietHoaDon`   | MÃ³n, sá»‘ lÆ°á»£ng, Ä‘Æ¡n giÃ¡     |
| `ThanhToanHoaDon` | Giao dá»‹ch thanh toÃ¡n       |
| `SanPham`         | Danh má»¥c thá»©c uá»‘ng / Ä‘á»“ Äƒn |
--
#### 8ï¸âƒ£ Tráº¡ng thÃ¡i hÃ³a Ä‘Æ¡n
| Tráº¡ng thÃ¡i   | MÃ´ táº£                   |
| ------------ | ----------------------- |
| Chá» xÃ¡c nháº­n | Má»›i Ä‘áº·t                 |
| Äang pha cháº¿ | NhÃ¢n viÃªn Ä‘ang chuáº©n bá»‹ |
| Äang giao    | Giao táº­n nÆ¡i            |
| HoÃ n táº¥t     | ÄÃ£ giao / phá»¥c vá»¥ xong  |
| ÄÃ£ há»§y       | ÄÆ¡n bá»‹ há»§y              |
---
### ğŸ’° **CHá»¨C NÄ‚NG FS-03: THANH TOÃN**
#### Má»¥c tiÃªu:
Cung cáº¥p cÃ¡c phÆ°Æ¡ng thá»©c thanh toÃ¡n linh hoáº¡t cho cáº£ thuÃª sÃ¡ch vÃ  gá»i mÃ³n.
| PhÆ°Æ¡ng thá»©c      | MÃ´ táº£                                       | Ãp dá»¥ng            |
| ---------------- | ------------------------------------------- | ------------------ |
| **COD**          | Thanh toÃ¡n khi nháº­n hÃ ng                    | ThuÃª sÃ¡ch, Ä‘áº·t mÃ³n |
| **Chuyá»ƒn khoáº£n** | Chuyá»ƒn qua tÃ i khoáº£n ngÃ¢n hÃ ng              | ThuÃª sÃ¡ch, Ä‘áº·t mÃ³n |
| **VÃ­ Ä‘iá»‡n tá»­**   | Thanh toÃ¡n online (Momo, ZaloPay, VNPay...) | ThuÃª sÃ¡ch, Ä‘áº·t mÃ³n |
---
### ğŸ“‹ **CHá»¨C NÄ‚NG FS-04: THEO DÃ•I & Xá»¬ LÃ ÄÆ N HÃ€NG**
#### Má»¥c tiÃªu:
* GiÃºp khÃ¡ch hÃ ng xem tráº¡ng thÃ¡i Ä‘Æ¡n thuÃª hoáº·c Ä‘áº·t mÃ³n.
* GiÃºp nhÃ¢n viÃªn cáº­p nháº­t tiáº¿n trÃ¬nh xá»­ lÃ½.
#### Actor:
* **KhÃ¡ch hÃ ng:** xem lá»‹ch sá»­ Ä‘Æ¡n.
* **NhÃ¢n viÃªn:** xÃ¡c nháº­n, cáº­p nháº­t, há»§y, hoÃ n tiá»n.
#### Chá»©c nÄƒng chi tiáº¿t:
| MÃ£    | HÃ nh Ä‘á»™ng           | MÃ´ táº£                                    |
| ----- | ------------------- | ---------------------------------------- |
| F04.1 | Xem lá»‹ch sá»­ thuÃª    | Hiá»ƒn thá»‹ danh sÃ¡ch phiáº¿u thuÃª theo khÃ¡ch |
| F04.2 | Xem lá»‹ch sá»­ hÃ³a Ä‘Æ¡n | Hiá»ƒn thá»‹ danh sÃ¡ch hÃ³a Ä‘Æ¡n mÃ³n           |
| F04.3 | Há»§y Ä‘Æ¡n hÃ ng        | Cho phÃ©p há»§y náº¿u chÆ°a xá»­ lÃ½              |
| F04.4 | Cáº­p nháº­t tráº¡ng thÃ¡i | NhÃ¢n viÃªn cáº­p nháº­t tiáº¿n Ä‘á»™ Ä‘Æ¡n           |
---
## ğŸ§± 4. MÃ´ hÃ¬nh dá»¯ liá»‡u liÃªn quan
| Loáº¡i dá»¯ liá»‡u        | Báº£ng chÃ­nh                             | MÃ´ táº£                        |
| ------------------- | -------------------------------------- | ---------------------------- |
| **SÃ¡ch**            | `Sach`                                 | ThÃ´ng tin sÃ¡ch, sá»‘ lÆ°á»£ng tá»“n |
| **Phiáº¿u thuÃª**      | `PhieuThueSach`, `ChiTietPhieuThue`    | Ghi nháº­n thuÃª sÃ¡ch           |
| **MÃ³n / thá»©c uá»‘ng** | `SanPham`                              | Danh sÃ¡ch sáº£n pháº©m           |
| **HÃ³a Ä‘Æ¡n**         | `HoaDon`, `ChiTietHoaDon`              | Ghi nháº­n gá»i mÃ³n             |
| **KhÃ¡ch hÃ ng**      | `KhachHang`                            | ThÃ´ng tin ngÆ°á»i dÃ¹ng         |
| **Thanh toÃ¡n**      | `ThanhToanThueSach`, `ThanhToanHoaDon` | Quáº£n lÃ½ giao dá»‹ch tiá»n       |
---
## âœ… 5. Káº¿t luáº­n
* â€œThuÃª sÃ¡châ€ vÃ  â€œGá»i mÃ³nâ€ **lÃ  hai module Ä‘á»™c láº­p**.
* Cáº£ hai **chia sáº» chung há»‡ thá»‘ng Ä‘Äƒng nháº­p, khÃ¡ch hÃ ng, nhÃ¢n viÃªn, vÃ  thanh toÃ¡n.**
* KhÃ´ng cáº§n thÃªm báº£ng â€œgá»™pâ€, chá»‰ cáº§n **truy váº¥n chung theo `idKhachHang` hoáº·c dÃ¹ng VIEW** khi thá»‘ng kÃª.
* Cáº¥u trÃºc hiá»‡n táº¡i **Ä‘á»§ máº¡nh Ä‘á»ƒ má»Ÿ rá»™ng**, vÃ­ dá»¥:
  * ThÃªm â€œÄáº·t bÃ nâ€ (liÃªn káº¿t vá»›i HÃ³a Ä‘Æ¡n).
  * ThÃªm â€œMua sÃ¡châ€ (liÃªn káº¿t vá»›i Phiáº¿u thuÃª).
//////////////////
ğŸ§¾ Äáº¶C Táº¢ CHá»¨C NÄ‚NG Má»šI: THANH TOÃN (KHÃCH HÃ€NG ONLINE)

MÃ£ chá»©c nÄƒng: FS-09

ğŸ¯ 1ï¸âƒ£ Má»¥c Ä‘Ã­ch

Cho phÃ©p khÃ¡ch hÃ ng tá»± thanh toÃ¡n Ä‘Æ¡n hÃ ng thuÃª sÃ¡ch hoáº·c Ä‘áº·t mÃ³n online vá»›i cÃ¡c tÃ­nh nÄƒng:



Sá»­ dá»¥ng Ä‘iá»ƒm tÃ­ch lÅ©y Ä‘á»ƒ giáº£m giÃ¡.

Nháº­p mÃ£ khuyáº¿n mÃ£i / giáº£m giÃ¡.

Chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n: COD, chuyá»ƒn khoáº£n, vÃ­ Ä‘iá»‡n tá»­.

LÆ°u toÃ n bá»™ giao dá»‹ch vÃ o báº£ng ThanhToanOnline (má»›i).

Tá»± Ä‘á»™ng cá»™ng Ä‘iá»ƒm thÆ°á»Ÿng sau khi hoÃ n táº¥t thanh toÃ¡n.

ğŸ‘¥ 2ï¸âƒ£ Actor liÃªn quan

ActorVai trÃ²KhÃ¡ch hÃ ngTá»± thao tÃ¡c thanh toÃ¡n online cho Ä‘Æ¡n hÃ ngHá»‡ thá»‘ng thanh toÃ¡nKiá»ƒm tra mÃ£ giáº£m giÃ¡, trá»« Ä‘iá»ƒm, xÃ¡c nháº­n giao dá»‹chNhÃ¢n viÃªn / Quáº£n lÃ½Theo dÃµi vÃ  xá»­ lÃ½ cÃ¡c giao dá»‹ch online (náº¿u cáº§n tra soÃ¡t)

âš™ï¸ 3ï¸âƒ£ Luá»“ng nghiá»‡p vá»¥ chÃ­nh

BÆ°á»›cHÃ nh Ä‘á»™ng cá»§a khÃ¡ch hÃ ngHá»‡ thá»‘ng xá»­ lÃ½1ï¸âƒ£KhÃ¡ch hÃ ng má»Ÿ mÃ n hÃ¬nh thanh toÃ¡n cho Ä‘Æ¡n (thuÃª sÃ¡ch hoáº·c gá»i mÃ³n)Gá»i API GET /api/client/thanhtoan/init/{idDon} Ä‘á»ƒ táº£i dá»¯ liá»‡u (sáº£n pháº©m, tá»•ng tiá»n, Ä‘iá»ƒm hiá»‡n cÃ³, khuyáº¿n mÃ£i há»£p lá»‡)2ï¸âƒ£KhÃ¡ch nháº­p mÃ£ khuyáº¿n mÃ£i (náº¿u cÃ³)Há»‡ thá»‘ng gá»i POST /api/client/thanhtoan/check-km Ä‘á»ƒ kiá»ƒm tra Ä‘iá»u kiá»‡n3ï¸âƒ£KhÃ¡ch chá»n â€œdÃ¹ng Ä‘iá»ƒm thÆ°á»Ÿngâ€Há»‡ thá»‘ng trá»« Ä‘iá»ƒm táº¡m tÃ­nh, hiá»ƒn thá»‹ tá»•ng tiá»n giáº£m4ï¸âƒ£KhÃ¡ch chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n (COD / chuyá»ƒn khoáº£n / vÃ­ Ä‘iá»‡n tá»­)Hiá»ƒn thá»‹ hÆ°á»›ng dáº«n / chuyá»ƒn hÆ°á»›ng cá»•ng thanh toÃ¡n náº¿u online5ï¸âƒ£KhÃ¡ch xÃ¡c nháº­n â€œThanh toÃ¡nâ€Gá»­i POST /api/client/thanhtoan/confirm chá»©a dá»¯ liá»‡u mÃ£ KM, Ä‘iá»ƒm sá»­ dá»¥ng, phÆ°Æ¡ng thá»©c6ï¸âƒ£Náº¿u thanh toÃ¡n thÃ nh cÃ´ng- LÆ°u ThanhToanOnline

Giáº£m Ä‘iá»ƒm Ä‘Ã£ sá»­ dá»¥ng

Cá»™ng Ä‘iá»ƒm má»›i theo cáº¥u hÃ¬nh (CaiDatTichDiem)

Gá»­i thÃ´ng bÃ¡o xÃ¡c nháº­n qua Email / App |



| 7ï¸âƒ£ | Hiá»ƒn thá»‹ mÃ n hÃ¬nh â€œThanh toÃ¡n thÃ nh cÃ´ngâ€ | KÃ¨m mÃ£ giao dá»‹ch vÃ  chi tiáº¿t giáº£m giÃ¡ |

ğŸ” 4ï¸âƒ£ Luá»“ng lá»—i

TÃ¬nh huá»‘ngHá»‡ thá»‘ng xá»­ lÃ½MÃ£ giáº£m giÃ¡ khÃ´ng há»£p lá»‡ / háº¿t háº¡nHiá»ƒn thá»‹ thÃ´ng bÃ¡o vÃ  yÃªu cáº§u nháº­p mÃ£ khÃ¡cÄiá»ƒm tÃ­ch lÅ©y khÃ´ng Ä‘á»§Tá»± Ä‘á»™ng Ä‘iá»u chá»‰nh xuá»‘ng má»©c tá»‘i Ä‘a cÃ³ thá»ƒ sá»­ dá»¥ngGiao dá»‹ch thanh toÃ¡n tháº¥t báº¡iÄÃ¡nh dáº¥u ThanhToanOnline.TrangThai = 'Tháº¥t báº¡i' vÃ  thÃ´ng bÃ¡o khÃ¡chKáº¿t ná»‘i vÃ­ Ä‘iá»‡n tá»­ bá»‹ giÃ¡n Ä‘oáº¡nCho phÃ©p chá»n láº¡i phÆ°Æ¡ng thá»©c thanh toÃ¡n khÃ¡c

ğŸ’¾ 5ï¸âƒ£ Cáº¥u trÃºc dá»¯ liá»‡u vÃ  báº£ng má»›i

ğŸ†• Báº£ng 1: ThanhToanOnline

Ghi nháº­n cÃ¡c giao dá»‹ch thanh toÃ¡n cá»§a khÃ¡ch hÃ ng trÃªn app/web.





CREATE TABLE ThanhToanOnline (

    IdThanhToan INT IDENTITY(1,1) PRIMARY KEY,

    LoaiDon NVARCHAR(50),         -- 'HoaDon' hoáº·c 'PhieuThueSach'

    IdDon INT NOT NULL,           

    IdKhachHang INT NOT NULL,

    PhuongThuc NVARCHAR(50),      -- 'COD', 'Chuyá»ƒn khoáº£n', 'VÃ­ Ä‘iá»‡n tá»­'

    SoTien DECIMAL(18,2),

    MaGiaoDich NVARCHAR(100),

    TrangThai NVARCHAR(50),       -- 'ThÃ nh cÃ´ng', 'Tháº¥t báº¡i', 'Äang xá»­ lÃ½'

    NgayThanhToan DATETIME DEFAULT GETDATE(),

    DiemSuDung INT DEFAULT 0,

    GiamTuDiem DECIMAL(18,2) DEFAULT 0,

    IdKhuyenMai INT NULL,

    GiamTuKhuyenMai DECIMAL(18,2) DEFAULT 0,

    DiemTichLuyCong INT DEFAULT 0,

    FOREIGN KEY (IdKhachHang) REFERENCES KhachHang(IdKhachHang)

);

ğŸ†• Báº£ng 2: LichSuThanhToanOnline

LÆ°u váº¿t (log) chi tiáº¿t cÃ¡c láº§n xÃ¡c thá»±c giao dá»‹ch (Ä‘áº·c biá»‡t cho vÃ­ Ä‘iá»‡n tá»­ hoáº·c ngÃ¢n hÃ ng).





CREATE TABLE LichSuThanhToanOnline (

    IdLichSu INT IDENTITY(1,1) PRIMARY KEY,

    IdThanhToan INT NOT NULL,

    TrangThai NVARCHAR(100),

    NoiDung NVARCHAR(MAX),

    ThoiGian DATETIME DEFAULT GETDATE(),

    FOREIGN KEY (IdThanhToan) REFERENCES ThanhToanOnline(IdThanhToan)

);

âš™ï¸ 6ï¸âƒ£ API endpoints cho khÃ¡ch hÃ ng

APIMÃ´ táº£Method/api/client/thanhtoan/init/{idDon}Láº¥y thÃ´ng tin Ä‘Æ¡n, tá»•ng tiá»n, Ä‘iá»ƒm hiá»‡n cÃ³GET/api/client/thanhtoan/check-kmKiá»ƒm tra Ä‘iá»u kiá»‡n mÃ£ giáº£m giÃ¡POST/api/client/thanhtoan/confirmXÃ¡c nháº­n thanh toÃ¡n vÃ  lÆ°u dá»¯ liá»‡uPOST/api/client/thanhtoan/status/{maGiaoDich}Kiá»ƒm tra tráº¡ng thÃ¡i giao dá»‹chGET

ğŸ’³ 7ï¸âƒ£ Quy táº¯c tÃ­nh Ä‘iá»ƒm & giáº£m giÃ¡

Quy táº¯cCÃ´ng thá»©cÄiá»ƒm tÃ­ch lÅ©y má»›ifloor(Tá»•ng tiá»n thanh toÃ¡n / TiLeNhanDiem)Giáº£m tá»« Ä‘iá»ƒmÄiá»ƒm sá»­ dá»¥ng * TiLeDoiDiemGiáº£m tá»« khuyáº¿n mÃ£iTheo loáº¡i: pháº§n trÄƒm hoáº·c giÃ¡ trá»‹ cá»‘ Ä‘á»‹nhTá»•ng tiá»n cuá»‘i cÃ¹ngTá»•ng gá»‘c + Phá»¥ thu - Giáº£m KM - Giáº£m Ä‘iá»ƒm

ğŸ§© 8ï¸âƒ£ Giao diá»‡n (KhÃ¡ch hÃ ng)

MÃ n hÃ¬nh hiá»ƒn thá»‹:

Tá»•ng tiá»n

Ã” nháº­p mÃ£ khuyáº¿n mÃ£i

Ã” nháº­p â€œSá»‘ Ä‘iá»ƒm muá»‘n sá»­ dá»¥ngâ€

Káº¿t quáº£ giáº£m giÃ¡ hiá»ƒn thá»‹ Ä‘á»™ng (Giáº£m KM + Giáº£m Ä‘iá»ƒm)

Lá»±a chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n

NÃºt â€œXÃ¡c nháº­n thanh toÃ¡nâ€

Sau khi thanh toÃ¡n:

Hiá»ƒn thá»‹ mÃ n hÃ¬nh xÃ¡c nháº­n (Success screen)

Cho phÃ©p xem láº¡i chi tiáº¿t giao dá»‹ch (link /LichSuThanhToan).

âœ… 9ï¸âƒ£ TÃ­ch há»£p vá»›i há»‡ thá»‘ng hiá»‡n cÃ³

DÃ¹ng chung báº£ng KhachHang (Ä‘á»ƒ láº¥y vÃ  cáº­p nháº­t Ä‘iá»ƒm).

DÃ¹ng KhuyenMai Ä‘á»ƒ kiá»ƒm tra mÃ£ há»£p lá»‡.

Gá»i API hiá»‡n cÃ³ /api/app/nhanvien/khuyenmai/available ná»™i bá»™ Ä‘á»ƒ lá»c khuyáº¿n mÃ£i há»£p lá»‡ cho Ä‘Æ¡n khÃ¡ch.

Khi thanh toÃ¡n xong, cáº­p nháº­t:

KhachHang.DiemTichLuy = DiemTichLuy - DiemSuDung + DiemTichLuyCong

Ghi ThanhToanOnline vÃ  LichSuThanhToanOnline.

ğŸ§± 10ï¸âƒ£ TÃ³m táº¯t nghiá»‡p vá»¥

TÃªn chá»©c nÄƒngMá»¥c tiÃªuActorBáº£ng liÃªn quanThanh toÃ¡n OnlineCho phÃ©p khÃ¡ch tá»± thanh toÃ¡n Ä‘Æ¡nKhÃ¡ch hÃ ngThanhToanOnline, LichSuThanhToanOnlineÃp dá»¥ng Ä‘iá»ƒm thÆ°á»ŸngTrá»« Ä‘iá»ƒm Ä‘á»ƒ giáº£m giÃ¡KhÃ¡ch hÃ ngKhachHang, LichSuDiemÃp dá»¥ng mÃ£ giáº£m giÃ¡Giáº£m giÃ¡ trá»±c tiáº¿p theo chÆ°Æ¡ng trÃ¬nhKhÃ¡ch hÃ ngKhuyenMai, HoaDon_KhuyenMaiCá»™ng Ä‘iá»ƒm sau thanh toÃ¡nThÆ°á»Ÿng cho khÃ¡ch hÃ ng trung thÃ nhHá»‡ thá»‘ngKhachHang, LichSuDiem

ğŸ§  Káº¿t luáº­n

ThanhToanOnline lÃ  module song song vá»›i ThanhToanView cá»§a nhÃ¢n viÃªn, nhÆ°ng logic tÃ­nh toÃ¡n tÆ°Æ¡ng tá»±.

KhÃ¡ch hÃ ng chá»‰ thao tÃ¡c pháº§n Ä‘áº§u, khÃ´ng xá»­ lÃ½ tÃ¡ch hÃ³a Ä‘Æ¡n hay phá»¥ thu.

Há»‡ thá»‘ng tá»± Ä‘á»™ng Ã¡p dá»¥ng khuyáº¿n mÃ£i, trá»« Ä‘iá»ƒm vÃ  ghi giao dá»‹ch.

Dá»¯ liá»‡u cÃ³ thá»ƒ Ä‘á»“ng bá»™ ngÆ°á»£c vá» backend Ä‘á»ƒ nhÃ¢n viÃªn tra soÃ¡t vÃ  in biÃªn lai náº¿u cáº§n.

ğŸ§© 1ï¸âƒ£ Giai Ä‘oáº¡n 1 â€“ Táº¡o vÃ  quáº£n lÃ½ giá» hÃ ng (Session-based)

ğŸ”¹ Äá»‘i tÆ°á»£ng: CartItemDto

LÆ°u trong Session theo khÃ³a SessionExtensions.CartKey.

Thuá»™c tÃ­nhMÃ´ táº£IdID cá»§a sÃ¡ch hoáº·c sáº£n pháº©mLoaiâ€œSachâ€ hoáº·c â€œSanPhamâ€SoLuongSá»‘ lÆ°á»£ng (sÃ¡ch = 1 cá»‘ Ä‘á»‹nh)

ğŸ”¹ Quy trÃ¬nh:

Khi ngÆ°á»i dÃ¹ng nháº¥n â€œThÃªm vÃ o giá» hÃ ngâ€:

App kiá»ƒm tra HttpContext.Session.

Náº¿u chÆ°a cÃ³ giá» hÃ ng, táº¡o má»›i List<CartItemDto>.

ThÃªm item (sÃ¡ch hoáº·c mÃ³n).

LÆ°u láº¡i session qua HttpContext.Session.Set().

Khi ngÆ°á»i dÃ¹ng vÃ o trang /giohang:

Controller (GioHangViewPageModel) Ä‘á»c session.

Gá»i API (qua HttpClient) Ä‘á»ƒ láº¥y thÃ´ng tin chi tiáº¿t tá»«ng item:

Náº¿u Loai == "Sach" â†’ gá»i api/web/thuvien/{id}

Náº¿u Loai == "SanPham" â†’ gá»i api/web/thucdon/{id}

Dá»±ng GioHangItemViewModel vá»›i:

TenHienThi, HinhAnhUrl, DonGia, SoLuong, ThanhTien

Tráº£ vá» view hiá»ƒn thá»‹ danh sÃ¡ch vÃ  tá»•ng tiá»n (GioHangViewModel.TongTien).

NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ:

âŒ XÃ³a item khá»i giá» (OnPostRemove)

ğŸ”„ Cáº­p nháº­t sá»‘ lÆ°á»£ng (OnPostUpdateQuantity)



â†’ Náº¿u lÃ  â€œSÃ¡châ€, sá»‘ lÆ°á»£ng luÃ´n = 1.

ğŸ§± => Giai Ä‘oáº¡n nÃ y lÃ  táº¡m thá»i, dá»¯ liá»‡u chá»‰ náº±m trong Session, chÆ°a ghi vÃ o database.

ğŸ’³ 2ï¸âƒ£ Giai Ä‘oáº¡n 2 â€“ Tiáº¿n hÃ nh thanh toÃ¡n

Sau khi ngÆ°á»i dÃ¹ng nháº¥n â€œThanh toÃ¡nâ€, há»‡ thá»‘ng chuyá»ƒn sang ThanhToanView.



ğŸ”¹ Input tá»« giá» hÃ ng:

Danh sÃ¡ch sáº£n pháº©m trong session.

Tá»•ng tiá»n táº¡m tÃ­nh (GioHangViewModel.TongTien).

ğŸ”¹ Táº¡i trang ThanhToanView (Ä‘Ã£ cÃ³ báº£n nhÃ¢n viÃªn â†’ sáº½ tÃ¡i sá»­ dá»¥ng cho khÃ¡ch hÃ ng):

Há»‡ thá»‘ng thá»±c hiá»‡n:

BÆ°á»›cMÃ´ táº£ xá»­ lÃ½Káº¿t quáº£1Táº£i láº¡i danh sÃ¡ch mÃ³n / sÃ¡ch trong giá»Hiá»ƒn thá»‹ tá»•ng tiá»n táº¡m tÃ­nh2Cho phÃ©p nháº­p mÃ£ giáº£m giÃ¡ (KhuyenMai)Gá»i API kiá»ƒm tra há»£p lá»‡3Cho phÃ©p nháº­p Ä‘iá»ƒm thÆ°á»Ÿng cáº§n sá»­ dá»¥ng (DiemTichLuy)Giáº£m giÃ¡ táº¡m thá»i4Chá»n phÆ°Æ¡ng thá»©c thanh toÃ¡n (COD / Chuyá»ƒn khoáº£n / VÃ­ Ä‘iá»‡n tá»­)Cáº­p nháº­t lá»±a chá»n5XÃ¡c nháº­n Thanh toÃ¡nGá»­i API POST /api/client/thanhtoan/confirm
ğŸ§¾ 3ï¸âƒ£ Giai Ä‘oáº¡n 3 â€“ Ghi nháº­n Ä‘Æ¡n hÃ ng
ğŸ”¹ Náº¿u lÃ  Ä‘áº·t mÃ³n / Ä‘á»“ uá»‘ng:
Sinh HoaDon + ChiTietHoaDon
Ghi ThanhToanOnline (kÃ¨m giáº£m giÃ¡, Ä‘iá»ƒm)
Giáº£m KhuyenMai.soLuongConLai
Cáº­p nháº­t KhachHang.DiemTichLuy
ğŸ”¹ Náº¿u lÃ  thuÃª sÃ¡ch:
Sinh PhieuThueSach + ChiTietPhieuThue
Ghi ThanhToanOnline
Trá»« sÃ¡ch tá»“n kho (Sach.soLuongHienCo)
Ãp dá»¥ng logic Ä‘iá»ƒm thÆ°á»Ÿng tÆ°Æ¡ng tá»±.
ğŸ§© 4ï¸âƒ£ MÃ´ hÃ¬nh dá»¯ liá»‡u tham gia
Má»¥c Ä‘Ã­chBáº£ng / Dá»¯ liá»‡u liÃªn quanLÆ°u giá» hÃ ng táº¡m thá»iSession[List<CartItemDto>]ÄÆ¡n Ä‘áº·t mÃ³nHoaDon, ChiTietHoaDonÄÆ¡n thuÃª sÃ¡chPhieuThueSach, ChiTietPhieuThueKhuyáº¿n mÃ£iKhuyenMai, HoaDon_KhuyenMaiÄiá»ƒm thÆ°á»ŸngKhachHang, LichSuDiemThanh toÃ¡n onlineThanhToanOnline, LichSuThanhToanOnline
ğŸ§® 5ï¸âƒ£ Quy táº¯c tÃ­nh toÃ¡n
CÃ´ng thá»©cDiá»…n giáº£iTá»•ng táº¡m tÃ­nh = Î£ (ÄÆ¡n giÃ¡ Ã— Sá»‘ lÆ°á»£ng)TÃ­nh tá»« GioHangViewModelGiáº£m tá»« khuyáº¿n mÃ£i = pháº§n trÄƒm hoáº·c sá»‘ tiá»nTheo KhuyenMaiGiáº£m tá»« Ä‘iá»ƒm = DiemSuDung Ã— TiLeDoiDiemTheo cáº¥u hÃ¬nhTá»•ng thanh toÃ¡n = Tá»•ng táº¡m tÃ­nh - Giáº£m KM - Giáº£m Ä‘iá»ƒmKáº¿t quáº£ cuá»‘iÄiá»ƒm thÆ°á»Ÿng má»›i = floor(Tá»•ng thanh toÃ¡n / TiLeNhanDiem)Cá»™ng vÃ o tÃ i khoáº£n khÃ¡ch
ğŸ“¦ 6ï¸âƒ£ Giai Ä‘oáº¡n 4 â€“ Sau thanh toÃ¡n
HÃ nh Ä‘á»™ngHá»‡ thá»‘ng xá»­ lÃ½Giao dá»‹ch thÃ nh cÃ´ngCáº­p nháº­t ThanhToanOnline.TrangThai = 'HoÃ n táº¥t'Giao dá»‹ch lá»—iTrangThai = 'Tháº¥t báº¡i', hoÃ n Ä‘iá»ƒm vÃ  khuyáº¿n mÃ£iXÃ³a session giá» hÃ ngKhi Ä‘Æ¡n Ä‘Ã£ xÃ¡c nháº­nGá»­i thÃ´ng bÃ¡oEmail / ThÃ´ng bÃ¡o app xÃ¡c nháº­n giao dá»‹ch thÃ nh cÃ´ng
///////////
